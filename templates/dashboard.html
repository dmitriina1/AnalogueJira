{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h1>My Trello Board</h1>
        <button id="add-list-btn" class="btn btn-primary">Add List</button>
    </div>
    
    <div class="lists-container" id="lists-container">
        {% for list in lists %}
        <div class="list" data-list-id="{{ list.id }}">
            <div class="list-header">
                <h3>{{ list.name }}</h3>
                <div class="list-actions">
                    <button class="add-card-btn" data-list-id="{{ list.id }}">+</button>
                    <button class="delete-list-btn" data-list-id="{{ list.id }}">Ã—</button>
                </div>
            </div>
            <div class="cards-container" data-list-id="{{ list.id }}">
                {% for card in list.cards %}
                <div class="card" draggable="true" data-card-id="{{ card.id }}" data-list-id="{{ list.id }}">
                    <!-- ÐœÐµÑ‚ÐºÐ¸ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ -->
                    {% if card.labels_list %}
                    <div class="card-labels">
                        {% for label in card.labels_list %}
                        <span class="card-label" style="background-color: {{ label.color }};" title="{{ label.name }}"></span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="card-content">
                        <h4>{{ card.title }}</h4>
                        {% if card.description %}
                        <p>{{ card.description }}</p>
                        {% endif %}
                        
                        <!-- Ð‘ÑÐ¹Ð´Ð¶Ð¸ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ -->
                        <div class="card-badges">
                            {% if card.due_date %}
                            <span class="badge due-date {% if card.due_date < now %}overdue{% endif %}">
                                ðŸ“… {{ card.due_date.strftime('%d %b') }}
                            </span>
                            {% endif %}
                            
                            {% if card.assignees_list %}
                            <span class="badge assignees">
                                ðŸ‘¥ {{ card.assignees_list|length }}
                            </span>
                            {% endif %}
                            
                            {% if card.checklists %}
                            <span class="badge checklist">
                                âœ… {{ card.completed_checklist_items }}/{{ card.total_checklist_items }}
                            </span>
                            {% endif %}
                            
                            {% if card.comments %}
                            <span class="badge comments">
                                ðŸ’¬ {{ card.comments|length }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ -->
                    {% if card.assignees_list %}
                    <div class="card-assignees">
                        {% for assignee in card.assignees_list %}
                        <span class="assignee-avatar" title="{{ assignee.username }}">
                            {{ assignee.username[0]|upper }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="card-actions">
                        <button class="edit-card-btn" data-card-id="{{ card.id }}">âœŽ</button>
                        <button class="delete-card-btn" data-card-id="{{ card.id }}">Ã—</button>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="add-card-text-btn" data-list-id="{{ list.id }}">+ Add another card</button>
        </div>
        {% endfor %}
    </div>
</div>

<!-- ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐ¿Ð¸ÑÐºÐ° -->
<div id="list-modal" class="modal">
    <div class="modal-content">
        <h3>Create New List</h3>
        <form id="list-form">
            <div class="form-group">
                <label for="list-name">List Name:</label>
                <input type="text" id="list-name" required placeholder="Enter list name...">
            </div>
            <div class="form-actions">
                <button type="button" id="cancel-list" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Create List</button>
            </div>
        </form>
    </div>
</div>

<!-- Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾Ðµ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ/Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ -->
<!-- Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾Ðµ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ/Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ -->
<div id="card-detail-modal" class="modal">
    <div class="modal-content">
        <h3 id="card-modal-title">Edit Card</h3>
        <form id="card-detail-form">
            <input type="hidden" id="card-detail-id">
            <input type="hidden" id="card-detail-list-id">
            
            <div class="card-modal-columns">
                <!-- Ð›ÐµÐ²Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° - Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¿Ð¾Ð»Ñ -->
                <div class="left-column">
                    <div class="form-group">
                        <label for="card-detail-title">Title:</label>
                        <input type="text" id="card-detail-title" required placeholder="Enter card title...">
                    </div>
                    
                    <div class="form-group">
                        <label for="card-detail-description">Description:</label>
                        <textarea id="card-detail-description" placeholder="Enter description..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="card-detail-due-date">Due Date:</label>
                        <input type="datetime-local" id="card-detail-due-date">
                    </div>
                </div>
                
                <!-- ÐŸÑ€Ð°Ð²Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° - Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ (ÑÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸) -->
                <div class="right-column form-section">
                    <!-- Ð¡ÐµÐºÑ†Ð¸Ñ Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹ -->
                    <div class="form-section">
                        <h4>Assignees</h4>
                        <div class="compact-container" id="assignees-container">
                            <!-- ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð·Ð´ÐµÑÑŒ -->
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <select id="assignee-select" class="form-control" style="flex: 1;">
                                <option value="">Select user...</option>
                            </select>
                            <button type="button" id="add-assignee-btn" class="btn btn-primary btn-sm">Assign</button>
                        </div>
                    </div>
                    
                    <!-- Ð¡ÐµÐºÑ†Ð¸Ñ Ð¼ÐµÑ‚Ð¾Ðº -->
                    <div class="form-section">
                        <h4>Labels</h4>
                        <div class="compact-container" id="labels-container">
                            <!-- ÐœÐµÑ‚ÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð·Ð´ÐµÑÑŒ -->
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 8px;">
                            <select id="label-select" class="form-control" style="flex: 1;">
                                <option value="">Select label...</option>
                            </select>
                            <button type="button" id="add-label-btn" class="btn btn-primary btn-sm">Add</button>
                        </div>
                        <button type="button" id="create-label-btn" class="btn btn-primary btn-sm" style="width: 100%; margin-top: 8px;">
                            Create New Label
                        </button>
                    </div>
                    
                    <!-- Ð¡ÐµÐºÑ†Ð¸Ñ Ñ‡ÐµÐº-Ð»Ð¸ÑÑ‚Ð¾Ð² -->
                    <div class="form-section">
    <h4>Checklist</h4>
    <div class="compact-container" id="checklists-container">
        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‡ÐµÐºÐ±Ð¾ÐºÑÐ¾Ð² Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°Ñ‚ÑŒÑÑ Ð·Ð´ÐµÑÑŒ -->
    </div>
    <div id="checklist-actions-container">
        <!-- Ð¤Ð¾Ñ€Ð¼Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸ ÐºÐ½Ð¾Ð¿ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð´ÐµÑÑŒ -->
    </div>
</div>
                    
                    <!-- Ð¡ÐµÐºÑ†Ð¸Ñ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ² -->
                    <div class="form-section">
                        <h4>Comments</h4>
                        <div class="compact-container" id="comments-container">
                            <!-- ÐšÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒÑÑ Ð·Ð´ÐµÑÑŒ -->
                        </div>
                        <div style="margin-top: 8px;">
                            <textarea id="new-comment-text" placeholder="Write a comment..." class="form-control" style="height: 60px; margin-bottom: 8px;"></textarea>
                            <button type="button" id="add-comment-btn" class="btn btn-primary btn-sm" style="width: 100%;">
                                Add Comment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
            <div class="modal-actions">
                <div class="form-actions">
                    <button type="button" id="cancel-card-detail" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Card</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¾ÐºÐ½Ð° (label-modal, checklist-modal) Ð¾ÑÑ‚Ð°ÑŽÑ‚ÑÑ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ -->

<!-- ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¼ÐµÑ‚ÐºÐ¸ -->
<div id="label-modal" class="modal">
    <div class="modal-content">
        <h3>Create New Label</h3>
        <form id="label-form">
            <div class="form-group">
                <label for="label-name">Label Name:</label>
                <input type="text" id="label-name" required placeholder="Enter label name...">
            </div>
            <div class="form-group">
                <label for="label-color">Color:</label>
                <input type="color" id="label-color" value="#0079bf">
            </div>
            <div class="form-actions">
                <button type="button" id="cancel-label" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Label</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}
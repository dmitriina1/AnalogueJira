{% extends "base.html" %}

{% block content %}
<div class="board-detail" style="background-color: {{ board.background_color }};">
    <div class="board-header">
        <h1>{{ board.name }}</h1>
        <p>{{ board.description }}</p>
        <div class="board-actions">
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">‚Üê All Boards</a>
            <button id="add-list-btn" class="btn btn-primary">Add List</button>
        </div>
    </div>
    
    <div class="lists-container" id="lists-container">
        {% for list in lists %}
        <div class="list" data-list-id="{{ list.id }}">
            <div class="list-header">
                <h3>{{ list.name }}</h3>
                <div class="list-actions">
                    <button class="add-card-btn" data-list-id="{{ list.id }}">+</button>
                    <button class="archive-list-btn" data-list-id="{{ list.id }}">√ó</button>
                </div>
            </div>
            <div class="cards-container" data-list-id="{{ list.id }}">
                {% for card in list.cards %}
                <div class="card" draggable="true" data-card-id="{{ card.id }}">
                    <!-- Labels -->
                    {% if card.labels_list %}
                    <div class="card-labels">
                        {% for label in card.labels_list %}
                        <span class="card-label" style="background-color: {{ label.color }};"></span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="card-content">
                        <h4>{{ card.title }}</h4>
                        {% if card.description %}
                        <p>{{ card.description }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Card Meta -->
                    <div class="card-meta">
                        {% if card.due_date %}
                        <div class="due-date {% if card.due_date < now %}overdue{% endif %}">
                            üìÖ {{ card.due_date.strftime('%m/%d') }}
                        </div>
                        {% endif %}
                        
                        {% if card.assignee %}
                        <div class="assignee" title="{{ card.assignee.username }}">
                            {{ card.assignee.username[:1].upper() }}
                        </div>
                        {% endif %}
                        
                        {% if card.checklists_list %}
                        <div class="checklist-progress">
                            ‚úÖ {{ card.checklists_list[0].items_list|selectattr('is_checked')|list|length }}/{{ card.checklists_list[0].items_list|length }}
                        </div>
                        {% endif %}
                        
                        {% if card.comments %}
                        <div class="comment-count">
                            üí¨ {{ card.comments|length }}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="card-actions">
                        <button class="edit-card-btn" data-card-id="{{ card.id }}">‚úé</button>
                        <button class="archive-card-btn" data-card-id="{{ card.id }}">√ó</button>
                    </div>
                </div>
                {% endfor %}
            </div>
            <button class="add-card-text-btn" data-list-id="{{ list.id }}">+ Add a card</button>
        </div>
        {% endfor %}
        
        <!-- Add List Column -->
        <div class="list add-list-column">
            <button id="add-list-text-btn" class="add-list-btn">
                + Add another list
            </button>
            <div class="add-list-form" style="display: none;">
                <input type="text" id="new-list-name" placeholder="Enter list title..." class="list-input">
                <div class="list-form-actions">
                    <button id="save-list-btn" class="btn btn-primary">Add</button>
                    <button id="cancel-list-btn" class="btn btn-secondary">√ó</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Card Modal -->
<div id="card-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="card-modal-title">Add Card</h3>
        <form id="card-form">
            <div class="form-group">
                <input type="text" id="card-title" required placeholder="Enter a title for this card...">
            </div>
            <div class="form-group">
                <textarea id="card-description" placeholder="Add a description..."></textarea>
            </div>
            
            <!-- Advanced Options -->
            <div class="advanced-options">
                <div class="form-group">
                    <label>Assign to:</label>
                    <select id="card-assignee">
                        <option value="">Unassigned</option>
                        {% for user in users %}
                        <option value="{{ user.id }}">{{ user.username }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Due date:</label>
                    <input type="date" id="card-due-date">
                </div>
                
                <div class="form-group">
                    <label>Labels:</label>
                    <div class="labels-options">
                        {% for label in labels %}
                        <label class="label-option">
                            <input type="checkbox" name="card-labels" value="{{ label.id }}">
                            <span class="label-color" style="background-color: {{ label.color }};"></span>
                            {{ label.name }}
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
            <input type="hidden" id="card-list-id">
            <input type="hidden" id="card-id">
            <div class="form-actions">
                <button type="button" id="cancel-card" class="btn btn-secondary">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Create Label Modal -->
<div id="label-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Create Label</h3>
        <form id="label-form">
            <div class="form-group">
                <input type="text" id="label-name" required placeholder="Label name">
            </div>
            <div class="form-group">
                <label>Color:</label>
                <input type="color" id="label-color" value="#ff6b6b">
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="cancel-label">Cancel</button>
                <button type="submit" class="btn btn-primary">Create</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}